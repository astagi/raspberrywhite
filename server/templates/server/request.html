{% extends "server/base.html" %}

{% load static %}

{% block content %}

  <div class="container-fluid">
    <input class="form-control" placeholder="❤ ♬ Search the song you want to play ♬ ❤" id="songinput" ng-model="query" ng-change="search()">
    <div id="songlist" class="list-group"></div>
    {% verbatim %}
    <div class='list-group-item listelement' ng-repeat="song in songs"
        ng-click="sendrequest(song)" id='{{ song.id }}'>
      <div style='width:84%; float:left;'>
        <h4 class='list-group-item-heading'>{{ song.artist }}</h4>
        <p class='list-group-item-text'>{{ song.title }}</p>
      </div>
    {% endverbatim %}
      <div>
        <img style="height:50px; white-space: nowrap;"
        src="{% static 'server/loading.gif' %}" ng-show="song.is_loading"/>
        <div style="height:50px; white-space: nowrap;" ng-hide="song.is_loading"/>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    app.config(['$httpProvider', function($httpProvider) {
        $httpProvider.defaults.headers.common['X-CSRFToken'] = '{{ csrf_token|escapejs }}';
        $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';
    }]);
    app.controller('RaspiwhiteCtrl', function ($scope, $http) {
        $scope.nav = 'request';
        $scope.title = 'New request';
        $http.get("/songs/?term=")
          .success(function(data) {
            $scope.songs = data;
          });
        $scope.search = function() {
          $http.get("/songs/?term=" + $scope.query)
            .success(function(data) {
              $scope.songs = data;
            });
        }

        $scope.sendrequest = function(song) {
          $current_song = song;
          $current_song.is_loading = true;
          $http.post("/request/", $.param({ id_song: $current_song.id }))
            .success(function(data) {
              $current_song.is_loading = false;
            });
        }
    });

  </script>

{% endblock %}